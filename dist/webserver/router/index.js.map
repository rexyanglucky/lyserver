{"version":3,"sources":["../../../src/webserver/router/index.js"],"names":["path","require","rurl","fs","Router","constructor","area","controller","action","param","resolveUrl","url","rthis","purl","parse","originurl","pathname","charAt","substring","arr","split","length","redirectAction","req","res","findAction","actionPath","resolve","__dirname","existsSync","join","controllerFile","hasOwnProperty","actionMethod","call","writeHead","end","module","exports"],"mappings":"aAAA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AACA,IAAIC,OAAOD,QAAQ,KAAR,CAAX,C,CAA0B;AAC1B,IAAIE,KAAKF,QAAQ,IAAR,CAAT,C,CAAuB;AACvB,MAAMG,MAAN,CAAa;AACT;AACAC,kBAAc;AACV,aAAKC,IAAL,GAAY,EAAZ;AACA,aAAKC,UAAL,GAAkB,MAAlB;AACA,aAAKC,MAAL,GAAc,OAAd;AACA,aAAKC,KAAL,GAAW,EAAX;AACH;AACD;;;;AAIA;AACAC,eAAWC,GAAX,EAAgB;AACZ,YAAIC,QAAQ,IAAZ;AACA,YAAIC,OAAKX,KAAKY,KAAL,CAAWH,GAAX,CAAT;AACA,YAAII,YAAYF,KAAKG,QAArB;AACAD,oBAAYA,UAAUE,MAAV,CAAiB,CAAjB,KAAuB,GAAvB,GAA6BF,UAAUG,SAAV,CAAoB,CAApB,CAA7B,GAAsDH,SAAlE;AACA,YAAII,MAAMJ,UAAUK,KAAV,CAAgB,GAAhB,CAAV;AACA,YAAID,IAAIE,MAAJ,GAAa,CAAjB,EAAoB;AAChBT,kBAAMN,IAAN,GAAaa,IAAIE,MAAJ,GAAa,CAAb,GAAiBF,IAAI,CAAJ,CAAjB,GAA0B,EAAvC;AACAP,kBAAML,UAAN,GAAmBY,IAAIE,MAAJ,GAAa,CAAb,GAAiBF,IAAI,CAAJ,CAAjB,GAA0BA,IAAI,CAAJ,CAA7C;AACAP,kBAAMJ,MAAN,GAAeW,IAAIE,MAAJ,GAAa,CAAb,GAAiBF,IAAI,CAAJ,CAAjB,GAA0BA,IAAI,CAAJ,CAAzC;AACH,SAJD;AAKK,YAAIA,IAAIE,MAAJ,GAAa,CAAjB,EAAoB,CAAET,MAAML,UAAN,GAAmBY,IAAI,CAAJ,CAAnB,CAA4B;;AAE1D;AACD;;;;;AAKAG,mBAAeC,GAAf,EAAoBC,GAApB,EAAyB;AACrB,YAAIZ,QAAQ,IAAZ;AACA;AACA,YAAIa,aAAa,KAAjB;AACA,YAAIC,aAAa1B,KAAK2B,OAAL,CAAaC,SAAb,EAAwB,IAAxB,EAA8BhB,MAAMN,IAApC,EAA0C,YAA1C,EAAwDM,MAAML,UAAN,GAAmB,YAA3E,IAA2F,KAA5G;AACA,YAAIJ,GAAG0B,UAAH,CAAc7B,KAAK8B,IAAL,CAAUJ,UAAV,CAAd,CAAJ,EAA0C;AACtC,gBAAIK,iBAAiB9B,QAAQyB,UAAR,CAArB;AACA,gBAAIK,eAAeC,cAAf,CAA8BpB,MAAMJ,MAApC,CAAJ,EAAiD;AAC7CiB,6BAAa,IAAb;AACH;AACJ;;AAED,YAAIA,UAAJ,EAAgB;AACZ,gBAAIQ,eAAeF,eAAenB,MAAMJ,MAArB,CAAnB;AACAyB,yBAAaC,IAAb,CAAkBH,cAAlB,EAAiCR,GAAjC,EAAqCC,GAArC,EAAyCZ,KAAzC;;AAEA;AACH,SALD;AAMK;AACDY,gBAAIW,SAAJ,CAAc,GAAd,EAAmB,EAAE,gBAAgB,0BAAlB,EAAnB;AACAX,gBAAIY,GAAJ,CAAQ,iCAAR;AACH;;AAEJ,KAvDQ;;;AA0DbC,OAAOC,OAAP,GAAiBlC,MAAjB","file":"index.js","sourcesContent":["var path = require(\"path\");\r\nvar rurl = require(\"url\");//路由模块\r\nvar fs = require(\"fs\");//文件系统模块\r\nclass Router {\r\n    // __proto__:Object.prototype,\r\n    constructor() {\r\n        this.area = \"\";\r\n        this.controller = \"home\";\r\n        this.action = \"index\";\r\n        this.param={};\r\n    }\r\n    /**\r\n     * 解析URL 获取area,controller,action\r\n     * @param {String} url -请求的url路径\r\n     */\r\n    //todo 根据参数或者特性来判断路由\r\n    resolveUrl(url) {\r\n        let rthis = this;\r\n        let purl=rurl.parse(url);\r\n        let originurl = purl.pathname;\r\n        originurl = originurl.charAt(0) == \"/\" ? originurl.substring(1) : originurl;\r\n        let arr = originurl.split('/');\r\n        if (arr.length > 1) {\r\n            rthis.area = arr.length > 2 ? arr[0] : \"\";\r\n            rthis.controller = arr.length > 2 ? arr[1] : arr[0];\r\n            rthis.action = arr.length > 2 ? arr[2] : arr[1];\r\n        }\r\n        else if (arr.length > 0) { rthis.controller = arr[0]; }\r\n     \r\n    }\r\n    /**\r\n     * 渲染action\r\n     * @param {IncomingMessage} req - 请求信息\r\n     * @param {ServerResponse} res - 响应信息\r\n     */\r\n    redirectAction(req, res) {\r\n        var rthis = this;\r\n        //能否找到Action\r\n        var findAction = false;\r\n        var actionPath = path.resolve(__dirname, \"..\", rthis.area, \"controller\", rthis.controller + \"Controller\") + \".js\";\r\n        if (fs.existsSync(path.join(actionPath))) {\r\n            var controllerFile = require(actionPath);\r\n            if (controllerFile.hasOwnProperty(rthis.action)) {\r\n                findAction = true;\r\n            }\r\n        }\r\n\r\n        if (findAction) {\r\n            var actionMethod = controllerFile[rthis.action];\r\n            actionMethod.call(controllerFile,req,res,rthis);\r\n            \r\n            // actionMethod(req, res, rthis);\r\n        }\r\n        else {\r\n            res.writeHead(500, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n            res.end(\"controller or action not config\");\r\n        }\r\n\r\n    }\r\n}\r\n\r\nmodule.exports = Router;"]}