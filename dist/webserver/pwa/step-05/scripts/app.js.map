{"version":3,"sources":["../../../../../src/webserver/pwa/step-05/scripts/app.js"],"names":["app","isLoading","visibleCards","selectedCities","spinner","document","querySelector","cardTemplate","container","addDialog","daysOfWeek","getElementById","addEventListener","updateForecasts","toggleAddDialog","select","selected","options","selectedIndex","key","value","label","textContent","getForecast","push","saveSelectedCities","visible","classList","add","remove","updateForecastCard","data","dataLastUpdated","Date","created","sunrise","channel","astronomy","sunset","current","item","condition","humidity","atmosphere","wind","card","cloneNode","removeAttribute","appendChild","cardLastUpdatedElem","cardLastUpdated","getTime","text","date","getIconClass","code","Math","round","temp","speed","direction","nextDays","querySelectorAll","today","getDay","i","nextDay","daily","forecast","high","low","setAttribute","statement","url","request","XMLHttpRequest","onreadystatechange","readyState","DONE","status","response","JSON","parse","results","query","initialWeatherForecast","open","send","keys","Object","forEach","stringify","localStorage","weatherCode","parseInt","city"],"mappings":"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","file":"app.js","sourcesContent":["// Copyright 2016 Google Inc.\n// \n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// \n//      http://www.apache.org/licenses/LICENSE-2.0\n// \n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n(function() {\n  'use strict';\n\n  var app = {\n    isLoading: true,\n    visibleCards: {},\n    selectedCities: [],\n    spinner: document.querySelector('.loader'),\n    cardTemplate: document.querySelector('.cardTemplate'),\n    container: document.querySelector('.main'),\n    addDialog: document.querySelector('.dialog-container'),\n    daysOfWeek: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']\n  };\n\n\n  /*****************************************************************************\n   *\n   * Event listeners for UI elements\n   *\n   ****************************************************************************/\n\n  document.getElementById('butRefresh').addEventListener('click', function() {\n    // Refresh all of the forecasts\n    app.updateForecasts();\n  });\n\n  document.getElementById('butAdd').addEventListener('click', function() {\n    // Open/show the add new city dialog\n    app.toggleAddDialog(true);\n  });\n\n  document.getElementById('butAddCity').addEventListener('click', function() {\n    // Add the newly selected city\n    var select = document.getElementById('selectCityToAdd');\n    var selected = select.options[select.selectedIndex];\n    var key = selected.value;\n    var label = selected.textContent;\n    if (!app.selectedCities) {\n      app.selectedCities = [];\n    }\n    app.getForecast(key, label);\n    app.selectedCities.push({key: key, label: label});\n    app.saveSelectedCities();\n    app.toggleAddDialog(false);\n  });\n\n  document.getElementById('butAddCancel').addEventListener('click', function() {\n    // Close the add new city dialog\n    app.toggleAddDialog(false);\n  });\n\n\n  /*****************************************************************************\n   *\n   * Methods to update/refresh the UI\n   *\n   ****************************************************************************/\n\n  // Toggles the visibility of the add new city dialog.\n  app.toggleAddDialog = function(visible) {\n    if (visible) {\n      app.addDialog.classList.add('dialog-container--visible');\n    } else {\n      app.addDialog.classList.remove('dialog-container--visible');\n    }\n  };\n\n  // Updates a weather card with the latest weather forecast. If the card\n  // doesn't already exist, it's cloned from the template.\n  app.updateForecastCard = function(data) {\n    var dataLastUpdated = new Date(data.created);\n    var sunrise = data.channel.astronomy.sunrise;\n    var sunset = data.channel.astronomy.sunset;\n    var current = data.channel.item.condition;\n    var humidity = data.channel.atmosphere.humidity;\n    var wind = data.channel.wind;\n\n    var card = app.visibleCards[data.key];\n    if (!card) {\n      card = app.cardTemplate.cloneNode(true);\n      card.classList.remove('cardTemplate');\n      card.querySelector('.location').textContent = data.label;\n      card.removeAttribute('hidden');\n      app.container.appendChild(card);\n      app.visibleCards[data.key] = card;\n    }\n\n    // Verifies the data provide is newer than what's already visible\n    // on the card, if it's not bail, if it is, continue and update the\n    // time saved in the card\n    var cardLastUpdatedElem = card.querySelector('.card-last-updated');\n    var cardLastUpdated = cardLastUpdatedElem.textContent;\n    if (cardLastUpdated) {\n      cardLastUpdated = new Date(cardLastUpdated);\n      // Bail if the card has more recent data then the data\n      if (dataLastUpdated.getTime() < cardLastUpdated.getTime()) {\n        return;\n      }\n    }\n    cardLastUpdatedElem.textContent = data.created;\n\n    card.querySelector('.description').textContent = current.text;\n    card.querySelector('.date').textContent = current.date;\n    card.querySelector('.current .icon').classList.add(app.getIconClass(current.code));\n    card.querySelector('.current .temperature .value').textContent =\n      Math.round(current.temp);\n    card.querySelector('.current .sunrise').textContent = sunrise;\n    card.querySelector('.current .sunset').textContent = sunset;\n    card.querySelector('.current .humidity').textContent =\n      Math.round(humidity) + '%';\n    card.querySelector('.current .wind .value').textContent =\n      Math.round(wind.speed);\n    card.querySelector('.current .wind .direction').textContent = wind.direction;\n    var nextDays = card.querySelectorAll('.future .oneday');\n    var today = new Date();\n    today = today.getDay();\n    for (var i = 0; i < 7; i++) {\n      var nextDay = nextDays[i];\n      var daily = data.channel.item.forecast[i];\n      if (daily && nextDay) {\n        nextDay.querySelector('.date').textContent =\n          app.daysOfWeek[(i + today) % 7];\n        nextDay.querySelector('.icon').classList.add(app.getIconClass(daily.code));\n        nextDay.querySelector('.temp-high .value').textContent =\n          Math.round(daily.high);\n        nextDay.querySelector('.temp-low .value').textContent =\n          Math.round(daily.low);\n      }\n    }\n    if (app.isLoading) {\n      app.spinner.setAttribute('hidden', true);\n      app.container.removeAttribute('hidden');\n      app.isLoading = false;\n    }\n  };\n\n\n  /*****************************************************************************\n   *\n   * Methods for dealing with the model\n   *\n   ****************************************************************************/\n\n  /*\n   * Gets a forecast for a specific city and updates the card with the data.\n   * getForecast() first checks if the weather data is in the cache. If so,\n   * then it gets that data and populates the card with the cached data.\n   * Then, getForecast() goes to the network for fresh data. If the network\n   * request goes through, then the card gets updated a second time with the\n   * freshest data.\n   */\n  app.getForecast = function(key, label) {\n    var statement = 'select * from weather.forecast where woeid=' + key;\n    var url = 'https://query.yahooapis.com/v1/public/yql?format=json&q=' +\n        statement;\n    // TODO add cache logic here\n\n    // Fetch the latest data.\n    var request = new XMLHttpRequest();\n    request.onreadystatechange = function() {\n      if (request.readyState === XMLHttpRequest.DONE) {\n        if (request.status === 200) {\n          var response = JSON.parse(request.response);\n          var results = response.query.results;\n          results.key = key;\n          results.label = label;\n          results.created = response.query.created;\n          app.updateForecastCard(results);\n        }\n      } else {\n        // Return the initial weather forecast since no data is available.\n        app.updateForecastCard(initialWeatherForecast);\n      }\n    };\n    request.open('GET', url);\n    request.send();\n  };\n\n  // Iterate all of the cards and attempt to get the latest forecast data\n  app.updateForecasts = function() {\n    var keys = Object.keys(app.visibleCards);\n    keys.forEach(function(key) {\n      app.getForecast(key);\n    });\n  };\n\n  // TODO add saveSelectedCities function here\n  // Save list of cities to localStorage.\n  app.saveSelectedCities = function() {\n    var selectedCities = JSON.stringify(app.selectedCities);\n    localStorage.selectedCities = selectedCities;\n  };\n\n  app.getIconClass = function(weatherCode) {\n    // Weather codes: https://developer.yahoo.com/weather/documentation.html#codes\n    weatherCode = parseInt(weatherCode);\n    switch (weatherCode) {\n      case 25: // cold\n      case 32: // sunny\n      case 33: // fair (night)\n      case 34: // fair (day)\n      case 36: // hot\n      case 3200: // not available\n        return 'clear-day';\n      case 0: // tornado\n      case 1: // tropical storm\n      case 2: // hurricane\n      case 6: // mixed rain and sleet\n      case 8: // freezing drizzle\n      case 9: // drizzle\n      case 10: // freezing rain\n      case 11: // showers\n      case 12: // showers\n      case 17: // hail\n      case 35: // mixed rain and hail\n      case 40: // scattered showers\n        return 'rain';\n      case 3: // severe thunderstorms\n      case 4: // thunderstorms\n      case 37: // isolated thunderstorms\n      case 38: // scattered thunderstorms\n      case 39: // scattered thunderstorms (not a typo)\n      case 45: // thundershowers\n      case 47: // isolated thundershowers\n        return 'thunderstorms';\n      case 5: // mixed rain and snow\n      case 7: // mixed snow and sleet\n      case 13: // snow flurries\n      case 14: // light snow showers\n      case 16: // snow\n      case 18: // sleet\n      case 41: // heavy snow\n      case 42: // scattered snow showers\n      case 43: // heavy snow\n      case 46: // snow showers\n        return 'snow';\n      case 15: // blowing snow\n      case 19: // dust\n      case 20: // foggy\n      case 21: // haze\n      case 22: // smoky\n        return 'fog';\n      case 24: // windy\n      case 23: // blustery\n        return 'windy';\n      case 26: // cloudy\n      case 27: // mostly cloudy (night)\n      case 28: // mostly cloudy (day)\n      case 31: // clear (night)\n        return 'cloudy';\n      case 29: // partly cloudy (night)\n      case 30: // partly cloudy (day)\n      case 44: // partly cloudy\n        return 'partly-cloudy-day';\n    }\n  };\n\n  /*\n   * Fake weather data that is presented when the user first uses the app,\n   * or when the user has not saved any cities. See startup code for more\n   * discussion.\n   */\n  var initialWeatherForecast = {\n    key: '2459115',\n    label: 'New York, NY',\n    created: '2016-07-22T01:00:00Z',\n    channel: {\n      astronomy: {\n        sunrise: \"5:43 am\",\n        sunset: \"8:21 pm\"\n      },\n      item: {\n        condition: {\n          text: \"Windy\",\n          date: \"Thu, 21 Jul 2016 09:00 PM EDT\",\n          temp: 56,\n          code: 24\n        },\n        forecast: [\n          {code: 44, high: 86, low: 70},\n          {code: 44, high: 94, low: 73},\n          {code: 4, high: 95, low: 78},\n          {code: 24, high: 75, low: 89},\n          {code: 24, high: 89, low: 77},\n          {code: 44, high: 92, low: 79},\n          {code: 44, high: 89, low: 77}\n        ]\n      },\n      atmosphere: {\n        humidity: 56\n      },\n      wind: {\n        speed: 25,\n        direction: 195\n      }\n    }\n  };\n  // TODO uncomment line below to test app with fake data\n  // app.updateForecastCard(initialWeatherForecast);\n\n  /************************************************************************\n   *\n   * Code required to start the app\n   *\n   * NOTE: To simplify this codelab, we've used localStorage.\n   *   localStorage is a synchronous API and has serious performance\n   *   implications. It should not be used in production applications!\n   *   Instead, check out IDB (https://www.npmjs.com/package/idb) or\n   *   SimpleDB (https://gist.github.com/inexorabletash/c8069c042b734519680c)\n   ************************************************************************/\n\n  // TODO add startup code here\n  app.selectedCities = localStorage.selectedCities;\n  if (app.selectedCities) {\n    app.selectedCities = JSON.parse(app.selectedCities);\n    app.selectedCities.forEach(function(city) {\n      app.getForecast(city.key, city.label);\n    });\n  } else {\n    /* The user is using the app for the first time, or the user has not\n     * saved any cities, so show the user some fake data. A real app in this\n     * scenario could guess the user's location via IP lookup and then inject\n     * that data into the page.\n     */\n    app.updateForecastCard(initialWeatherForecast);\n    app.selectedCities = [\n      {key: initialWeatherForecast.key, label: initialWeatherForecast.label}\n    ];\n    app.saveSelectedCities();\n  }\n\n  // TODO add service worker code here\n})();\n"]}