{"version":3,"sources":["../../../../src/webserver/pwa/final/service-worker.js"],"names":["dataCacheName","cacheName","filesToCache","self","addEventListener","e","console","log","waitUntil","caches","open","then","cache","addAll","keys","keyList","Promise","all","map","key","delete","clients","claim","request","url","dataUrl","indexOf","respondWith","fetch","response","put","clone","match"],"mappings":"cAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,gBAAgB,gBAApB;AACA,IAAIC,YAAY,oBAAhB;AACA,IAAIC,eAAe;AACjB,GADiB;AAEjB,aAFiB;AAGjB,iBAHiB;AAIjB,oBAJiB;AAKjB,mBALiB;AAMjB,sCANiB;AAOjB,oBAPiB;AAQjB,iBARiB;AASjB,+BATiB;AAUjB,mCAViB;AAWjB,2BAXiB;AAYjB,kBAZiB;AAajB,+BAbiB;AAcjB,mBAdiB;AAejB,kBAfiB;AAgBjB,0BAhBiB;AAiBjB,kBAjBiB,CAAnB;;;AAoBAC,KAAKC,gBAAL,CAAsB,SAAtB,EAAiC,UAASC,CAAT,EAAY;AAC3CC,UAAQC,GAAR,CAAY,yBAAZ;AACAF,IAAEG,SAAF;AACEC,SAAOC,IAAP,CAAYT,SAAZ,EAAuBU,IAAvB,CAA4B,UAASC,KAAT,EAAgB;AAC1CN,YAAQC,GAAR,CAAY,mCAAZ;AACA,WAAOK,MAAMC,MAAN,CAAaX,YAAb,CAAP;AACD,GAHD,CADF;;AAMD,CARD;;AAUAC,KAAKC,gBAAL,CAAsB,UAAtB,EAAkC,UAASC,CAAT,EAAY;AAC5CC,UAAQC,GAAR,CAAY,0BAAZ;AACAF,IAAEG,SAAF;AACEC,SAAOK,IAAP,GAAcH,IAAd,CAAmB,UAASI,OAAT,EAAkB;AACnC,WAAOC,QAAQC,GAAR,CAAYF,QAAQG,GAAR,CAAY,UAASC,GAAT,EAAc;AAC3C,UAAIA,QAAQlB,SAAR,IAAqBkB,QAAQnB,aAAjC,EAAgD;AAC9CM,gBAAQC,GAAR,CAAY,oCAAZ,EAAkDY,GAAlD;AACA,eAAOV,OAAOW,MAAP,CAAcD,GAAd,CAAP;AACD;AACF,KALkB,CAAZ,CAAP;AAMD,GAPD,CADF;;AAUA;;;;;;;;;;AAUA,SAAOhB,KAAKkB,OAAL,CAAaC,KAAb,EAAP;AACD,CAvBD;;AAyBAnB,KAAKC,gBAAL,CAAsB,OAAtB,EAA+B,UAASC,CAAT,EAAY;AACzCC,UAAQC,GAAR,CAAY,wBAAZ,EAAsCF,EAAEkB,OAAF,CAAUC,GAAhD;AACA,MAAIC,UAAU,2CAAd;AACA,MAAIpB,EAAEkB,OAAF,CAAUC,GAAV,CAAcE,OAAd,CAAsBD,OAAtB,IAAiC,CAAC,CAAtC,EAAyC;AACvC;;;;;;;AAOApB,MAAEsB,WAAF;AACElB,WAAOC,IAAP,CAAYV,aAAZ,EAA2BW,IAA3B,CAAgC,UAASC,KAAT,EAAgB;AAC9C,aAAOgB,MAAMvB,EAAEkB,OAAR,EAAiBZ,IAAjB,CAAsB,UAASkB,QAAT,EAAkB;AAC7CjB,cAAMkB,GAAN,CAAUzB,EAAEkB,OAAF,CAAUC,GAApB,EAAyBK,SAASE,KAAT,EAAzB;AACA,eAAOF,QAAP;AACD,OAHM,CAAP;AAID,KALD,CADF;;AAQD,GAhBD,MAgBO;AACL;;;;;AAKAxB,MAAEsB,WAAF;AACElB,WAAOuB,KAAP,CAAa3B,EAAEkB,OAAf,EAAwBZ,IAAxB,CAA6B,UAASkB,QAAT,EAAmB;AAC9C,aAAOA,YAAYD,MAAMvB,EAAEkB,OAAR,CAAnB;AACD,KAFD,CADF;;AAKD;AACF,CA/BD","file":"service-worker.js","sourcesContent":["// Copyright 2016 Google Inc.\r\n// \r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n// \r\n//      http://www.apache.org/licenses/LICENSE-2.0\r\n// \r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nvar dataCacheName = 'weatherData-v1';\r\nvar cacheName = 'weatherPWA-final-1';\r\nvar filesToCache = [\r\n  '/',\r\n  '/index.html',\r\n  '/scripts/app.js',\r\n  '/styles/inline.css',\r\n  '/images/clear.png',\r\n  '/images/cloudy-scattered-showers.png',\r\n  '/images/cloudy.png',\r\n  '/images/fog.png',\r\n  '/images/ic_add_white_24px.svg',\r\n  '/images/ic_refresh_white_24px.svg',\r\n  '/images/partly-cloudy.png',\r\n  '/images/rain.png',\r\n  '/images/scattered-showers.png',\r\n  '/images/sleet.png',\r\n  '/images/snow.png',\r\n  '/images/thunderstorm.png',\r\n  '/images/wind.png'\r\n];\r\n\r\nself.addEventListener('install', function(e) {\r\n  console.log('[ServiceWorker] Install');\r\n  e.waitUntil(\r\n    caches.open(cacheName).then(function(cache) {\r\n      console.log('[ServiceWorker] Caching app shell');\r\n      return cache.addAll(filesToCache);\r\n    })\r\n  );\r\n});\r\n\r\nself.addEventListener('activate', function(e) {\r\n  console.log('[ServiceWorker] Activate');\r\n  e.waitUntil(\r\n    caches.keys().then(function(keyList) {\r\n      return Promise.all(keyList.map(function(key) {\r\n        if (key !== cacheName && key !== dataCacheName) {\r\n          console.log('[ServiceWorker] Removing old cache', key);\r\n          return caches.delete(key);\r\n        }\r\n      }));\r\n    })\r\n  );\r\n  /*\r\n   * Fixes a corner case in which the app wasn't returning the latest data.\r\n   * You can reproduce the corner case by commenting out the line below and\r\n   * then doing the following steps: 1) load app for first time so that the\r\n   * initial New York City data is shown 2) press the refresh button on the\r\n   * app 3) go offline 4) reload the app. You expect to see the newer NYC\r\n   * data, but you actually see the initial data. This happens because the\r\n   * service worker is not yet activated. The code below essentially lets\r\n   * you activate the service worker faster.\r\n   */\r\n  return self.clients.claim();\r\n});\r\n\r\nself.addEventListener('fetch', function(e) {\r\n  console.log('[Service Worker] Fetch', e.request.url);\r\n  var dataUrl = 'https://query.yahooapis.com/v1/public/yql';\r\n  if (e.request.url.indexOf(dataUrl) > -1) {\r\n    /*\r\n     * When the request URL contains dataUrl, the app is asking for fresh\r\n     * weather data. In this case, the service worker always goes to the\r\n     * network and then caches the response. This is called the \"Cache then\r\n     * network\" strategy:\r\n     * https://jakearchibald.com/2014/offline-cookbook/#cache-then-network\r\n     */\r\n    e.respondWith(\r\n      caches.open(dataCacheName).then(function(cache) {\r\n        return fetch(e.request).then(function(response){\r\n          cache.put(e.request.url, response.clone());\r\n          return response;\r\n        });\r\n      })\r\n    );\r\n  } else {\r\n    /*\r\n     * The app is asking for app shell files. In this scenario the app uses the\r\n     * \"Cache, falling back to the network\" offline strategy:\r\n     * https://jakearchibald.com/2014/offline-cookbook/#cache-falling-back-to-network\r\n     */\r\n    e.respondWith(\r\n      caches.match(e.request).then(function(response) {\r\n        return response || fetch(e.request);\r\n      })\r\n    );\r\n  }\r\n});\r\n"]}