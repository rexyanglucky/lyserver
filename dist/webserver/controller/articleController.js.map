{"version":3,"sources":["../../../src/webserver/controller/articleController.js"],"names":["controller","bll","add","req","res","router","param","createTime","Date","toUTCString","updateTime","files","length","promiseList","map","item","index","arr","WriteFile","then","url","name","console","log","self","Promise","all","saveArticle","result","writeHead","end","JSON","stringify","code","data","catch","err","stack","detial","id","getArticle","list","getArticleList","delete","delArticle","module","exports"],"mappings":"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","file":"articleController.js","sourcesContent":["import { default as Bll } from \"../../bll/article\";\r\nimport { Stream } from \"stream\";\r\nimport path from 'path';\r\nimport FileHelper from \"../../common/file\"\r\nlet controller = {\r\n    bll: new Bll(),\r\n\r\n    add(req, res, router) {\r\n        let param = router.param;\r\n        param.createTime = new Date().toUTCString();\r\n        param.updateTime = new Date().toUTCString();\r\n        if (router.files && router.files.length > 0) {\r\n            let promiseList = router.files.map((item, index, arr) => { \r\n                return FileHelper.WriteFile(item).then((url) => {\r\n                    param[item.name] = url;\r\n                })\r\n            });\r\n            console.log(param);\r\n            let self = this;\r\n            Promise.all(promiseList).then(() => {\r\n                self.bll.saveArticle(\r\n                    (result) => {\r\n                        res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n                        res.end(JSON.stringify({ code: 1, data: result }));\r\n                    },\r\n                    param\r\n                );\r\n            }).catch(err=>{\r\n                res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n                res.end(JSON.stringify({ code: 1, data: err.stack }));\r\n            })\r\n\r\n        }\r\n        else {\r\n            console.log(param);\r\n            this.bll.saveArticle(\r\n                (result) => {\r\n                    res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n                    res.end(JSON.stringify({ code: 1, data: result }));\r\n                },\r\n                param\r\n            );\r\n        }\r\n    },\r\n    /**\r\n     * 查看文章详情\r\n     * @param {*} req \r\n     * @param {*} res \r\n     * @param {*} router \r\n     */\r\n    detial(req, res, router) {\r\n        let id = router.param.id;\r\n        this.bll.getArticle((result) => {\r\n            res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n            res.end(JSON.stringify({ code: 1, data: result }));\r\n        }, id)\r\n    },\r\n    list(req, res, router) {\r\n        let param = router.param;\r\n        this.bll.getArticleList((result) => {\r\n            res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n            res.end(JSON.stringify({ code: 1, data: result }));\r\n        }, param);\r\n\r\n    },\r\n    delete(req, res, router) {\r\n        let id = router.param.id;\r\n        this.bll.delArticle((result) => {\r\n            res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n            res.end(JSON.stringify({ code: 1, data: result }));\r\n        }, id)\r\n    }\r\n\r\n\r\n}\r\nmodule.exports = controller;"]}