{"version":3,"sources":["../../../src/webserver/controller/articleController.js"],"names":["articleController","bll","add","req","res","router","param","createTime","Date","toUTCString","updateTime","files","length","promiseList","map","item","index","arr","WriteFile","then","url","name","self","Promise","all","saveArticle","result","writeHead","end","JSON","stringify","code","data","catch","err","stack","console","log","detial","id","getArticle","list","getArticleList","content","replace","substr","delete","delArticle","module","exports"],"mappings":"aAAA,4C;AACA;AACA,4B;AACA,yC;AACA;AACA,IAAIA,oBAAoB;AACpBC,SAAK,uBADe;;;AAIpB;;;;;;;;;;;;AAYAC,QAAIC,GAAJ,EAASC,GAAT,EAAcC,MAAd,EAAsB;AAClB,YAAIC,QAAQD,OAAOC,KAAnB;AACAA,cAAMC,UAAN,GAAmB,IAAIC,IAAJ,GAAWC,WAAX,EAAnB;AACAH,cAAMI,UAAN,GAAmB,IAAIF,IAAJ,GAAWC,WAAX,EAAnB;AACA,YAAIJ,OAAOM,KAAP,IAAgBN,OAAOM,KAAP,CAAaC,MAAb,GAAsB,CAA1C,EAA6C;AACzC,gBAAIC,cAAcR,OAAOM,KAAP,CAAaG,GAAb,CAAiB,CAACC,IAAD,EAAOC,KAAP,EAAcC,GAAd,KAAsB;AACrD,uBAAO,eAAWC,SAAX,CAAqBH,IAArB,EAA2BI,IAA3B,CAAiCC,GAAD,IAAS;AAC5Cd,0BAAMS,KAAKM,IAAX,IAAmBD,GAAnB;AACH,iBAFM,CAAP;AAGH,aAJiB,CAAlB;AAKA,gBAAIE,OAAO,IAAX;AACAC,oBAAQC,GAAR,CAAYX,WAAZ,EAAyBM,IAAzB,CAA8B,MAAM;AAChCG,qBAAKrB,GAAL,CAASwB,WAAT;AACKC,sBAAD,IAAY;AACRtB,wBAAIuB,SAAJ,CAAc,GAAd,EAAmB,EAAE,gBAAgB,0BAAlB,EAAnB;AACAvB,wBAAIwB,GAAJ,CAAQC,KAAKC,SAAL,CAAe,EAAEC,MAAM,CAAR,EAAWC,MAAMN,MAAjB,EAAf,CAAR;AACH,iBAJL;AAKIpB,qBALJ;;AAOH,aARD,EAQG2B,KARH,CAQSC,OAAO;AACZ9B,oBAAIuB,SAAJ,CAAc,GAAd,EAAmB,EAAE,gBAAgB,0BAAlB,EAAnB;AACAvB,oBAAIwB,GAAJ,CAAQC,KAAKC,SAAL,CAAe,EAAEC,MAAM,CAAR,EAAWC,MAAME,IAAIC,KAArB,EAAf,CAAR;AACH,aAXD;AAYH,SAnBD;AAoBK;AACDC,oBAAQC,GAAR,CAAY/B,KAAZ;AACA,iBAAKL,GAAL,CAASwB,WAAT;AACKC,kBAAD,IAAY;AACRtB,oBAAIuB,SAAJ,CAAc,GAAd,EAAmB,EAAE,gBAAgB,0BAAlB,EAAnB;AACAvB,oBAAIwB,GAAJ,CAAQC,KAAKC,SAAL,CAAe,EAAEC,MAAM,CAAR,EAAWC,MAAMN,MAAjB,EAAf,CAAR;AACH,aAJL;AAKIpB,iBALJ;;AAOH;AACJ,KAlDmB;AAmDlB;;;;;;;;;;;;AAYFgC,WAAOnC,GAAP,EAAYC,GAAZ,EAAiBC,MAAjB,EAAyB;AACrB,YAAIkC,KAAKlC,OAAOC,KAAP,CAAaiC,EAAtB;AACA,aAAKtC,GAAL,CAASuC,UAAT,CAAqBd,MAAD,IAAY;AAC5BtB,gBAAIuB,SAAJ,CAAc,GAAd,EAAmB,EAAE,gBAAgB,0BAAlB,EAAnB;AACAvB,gBAAIwB,GAAJ,CAAQC,KAAKC,SAAL,CAAe,EAAEC,MAAM,CAAR,EAAWC,MAAMN,MAAjB,EAAf,CAAR;AACH,SAHD,EAGGa,EAHH;AAIH,KArEmB;AAsEhB;;;;;;;AAOJE,SAAKtC,GAAL,EAAUC,GAAV,EAAeC,MAAf,EAAuB;AACnB,YAAIC,QAAQD,OAAOC,KAAnB;AACA,aAAKL,GAAL,CAASyC,cAAT,CAAyBhB,MAAD,IAAY;AAChC,gBAAIiB,UAAUjB,OAAOiB,OAAP,GAAiBjB,OAAOiB,OAAP,CAAeC,OAAf,CAAuB,WAAvB,EAAoC,EAApC,CAAjB,GAA2D,EAAzE;AACAD,sBAAUA,QAAQ/B,MAAR,GAAiB,GAAjB,GAAuB+B,QAAQE,MAAR,CAAe,CAAf,EAAkB,GAAlB,IAAyB,KAAhD,GAAwDF,OAAlE;;AAEAvC,gBAAIuB,SAAJ,CAAc,GAAd,EAAmB,EAAE,gBAAgB,0BAAlB,EAAnB;AACAvB,gBAAIwB,GAAJ,CAAQC,KAAKC,SAAL,CAAe,EAAEC,MAAM,CAAR,EAAWC,MAAMN,MAAjB,EAAf,CAAR;AACH,SAND,EAMGpB,KANH;;AAQH,KAvFmB;AAwFhB;;;;;;;AAOJwC,WAAO3C,GAAP,EAAYC,GAAZ,EAAiBC,MAAjB,EAAyB;AACrB,YAAIkC,KAAKlC,OAAOC,KAAP,CAAaiC,EAAtB;AACA,aAAKtC,GAAL,CAAS8C,UAAT,CAAqBrB,MAAD,IAAY;AAC5BtB,gBAAIuB,SAAJ,CAAc,GAAd,EAAmB,EAAE,gBAAgB,0BAAlB,EAAnB;AACAvB,gBAAIwB,GAAJ,CAAQC,KAAKC,SAAL,CAAe,EAAEC,MAAM,CAAR,EAAWC,MAAMN,MAAjB,EAAf,CAAR;AACH,SAHD,EAGGa,EAHH;AAIH,KArGmB,EAAxB;;AAuGAS,OAAOC,OAAP,GAAiBjD,iBAAjB","file":"articleController.js","sourcesContent":["import { default as Bll } from \"../../bll/article\";\r\nimport { Stream } from \"stream\";\r\nimport path from 'path';\r\nimport FileHelper from \"../../common/file\"\r\n/** @namespace  */\r\nlet articleController = {\r\n    bll: new Bll(),\r\n\r\n\r\n    /**\r\n     * 添加文章\r\n     * @param {*} req \r\n     * @param {*} res \r\n     * @param {*} router \r\n     * @param {Object} param \r\n     * {content:{type:string,desc:'内容'},\r\n     * title:{type:string,desc:'标题'},\r\n     * headImg:{type:[blob],desc:'图片'},\r\n     * isMD:{type:boolean,desc:'是否是markdown'}}\r\n     * @returns {object} {code:1,data:result}\r\n     */\r\n    add(req, res, router) {\r\n        let param = router.param;\r\n        param.createTime = new Date().toUTCString();\r\n        param.updateTime = new Date().toUTCString();\r\n        if (router.files && router.files.length > 0) {\r\n            let promiseList = router.files.map((item, index, arr) => {\r\n                return FileHelper.WriteFile(item).then((url) => {\r\n                    param[item.name] = url;\r\n                })\r\n            });\r\n            let self = this;\r\n            Promise.all(promiseList).then(() => {\r\n                self.bll.saveArticle(\r\n                    (result) => {\r\n                        res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n                        res.end(JSON.stringify({ code: 1, data: result }));\r\n                    },\r\n                    param\r\n                );\r\n            }).catch(err => {\r\n                res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n                res.end(JSON.stringify({ code: 1, data: err.stack }));\r\n            })\r\n        }\r\n        else {\r\n            console.log(param);\r\n            this.bll.saveArticle(\r\n                (result) => {\r\n                    res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n                    res.end(JSON.stringify({ code: 1, data: result }));\r\n                },\r\n                param\r\n            );\r\n        }\r\n    },\r\n      /**\r\n     * 获取文章详情\r\n     * @param {*} req \r\n     * @param {*} res \r\n     * @param {*} router \r\n     * @param {string} id 文章ID\r\n     * @returns {object} \r\n     * {content:{type:string,desc:'内容'},\r\n     * title:{type:string,desc:'标题'},\r\n     * headImg:{type:[blob],desc:'图片'},\r\n     * isMD:{type:boolean,desc:'是否是markdown'}}\r\n     */\r\n    detial(req, res, router) {\r\n        let id = router.param.id;\r\n        this.bll.getArticle((result) => {\r\n            res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n            res.end(JSON.stringify({ code: 1, data: result }));\r\n        }, id)\r\n    },\r\n        /**\r\n     * 获取文章列表\r\n     * @param {*} req \r\n     * @param {*} res \r\n     * @param {*} router \r\n     * @returns {object} {code:1,data:result}\r\n     */\r\n    list(req, res, router) {\r\n        let param = router.param;\r\n        this.bll.getArticleList((result) => {\r\n            let content = result.content ? result.content.replace(/<\\/?.+?>/g, \"\") : \"\";\r\n            content = content.length > 100 ? content.substr(0, 100) + '...' : content;\r\n\r\n            res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n            res.end(JSON.stringify({ code: 1, data: result }));\r\n        }, param);\r\n\r\n    },\r\n        /**\r\n     * 删除文章\r\n     * @param {*} req \r\n     * @param {*} res \r\n     * @param {*} router \r\n     * @param {string} id 文章ID\r\n     */\r\n    delete(req, res, router) {\r\n        let id = router.param.id;\r\n        this.bll.delArticle((result) => {\r\n            res.writeHead(200, { 'Content-Type': 'text/plain;charset:utf-8' });\r\n            res.end(JSON.stringify({ code: 1, data: result }));\r\n        }, id)\r\n    }\r\n}\r\nmodule.exports = articleController;"]}